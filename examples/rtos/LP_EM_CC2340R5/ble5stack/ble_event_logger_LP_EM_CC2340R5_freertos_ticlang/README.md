## Introduction

The `BLE- Event Detecting & Logging "BLE-EDL"` project is based on the
data_stream_ble example and implements a simple Bluetooth low-energy
peripheral device with Simple GATT profile.\
This project can be a framework for developing many different
peripheral-role applications.\
The purpose of the BLE-EDL example is to allow users to advertise
timestamp of latest GPIO event and log up to 5 recent events using GATT
service. The features that this example includes are as follows:

-   Calendar Implementation using ClockP, with periodic interrupt to
    update the Calendar.
-   Thread for GPIO Event detection
-   Implementation of UART protocol for configuring the Base Time of
    Calendar
-   Passkey Authentication to read GPIO events 

`Note: For More Details pleaser refer Readme.html in this project`

## Hardware Prerequisites

The default BLE-EDL board configuration uses the device\'s LaunchPad
development kit.

## Software Prerequisites

For information on what versions of Code Composer Studio and IAR
Embedded Workbench to use, see the Release Notes file provided in the
SDK. In addition, please refer to the [User\'s
Guide](docs\ble5stack\ble_user_guide\ble5stack-users-guide.html) for
information on importing this project into your IDE workspace and
build/run.

## Mobile Application Requirements

- [SimpleLink Connect Application on iOS](https://apps.apple.com/app/simplelink-connect/id6445892658)
- [SimpleLink Connect Application on Android](https://play.google.com/store/apps/details?id=com.ti.connectivity.simplelinkconnect)
- [SimpleLink Connect Application source code](https://www.ti.com/tool/SIMPLELINK-CONNECT-SW-MOBILE-APP)

## Simple GATT Profile

The Simple GATT profile in this example contains 5 Characteristics and is used to store the Timestamp of the last 5 GPIO interrupt events (button presses).


  | Description | UUID                                      | Format                                      | Properties|
|:------------------------:|:-----------------------------------------:|:-----------------------------------------:|:-----------------------------------------:|
|Characteristic 1     | F000**FFF1**-0451-4000-B000-000000000000   |  7 byte uint8    |   Read (Authentication required)|
|Characteristic 2     |  F000**FFF2**-0451-4000-B000-000000000000  | 7 byte uint8     | Read (Authentication required)  |
  |Characteristic 3     |  F000**FFF3**-0451-4000-B000-000000000000  |  7 byte uint8    | Read (Authentication required)  |
  |Characteristic 4     | F000**FFF4**-0451-4000-B000-000000000000   | 7 byte uint8     | Read (Authentication required)  |
  |Characteristic 5     | F000**FFF5**-0451-4000-B000-000000000000   | 7 bytes uint8    |  Read (Authentication required) |


## Usage

The `BLE- Event Detecting & Logging "BLE-EDL"` starts by creating thread
for GPIO Event Detection and ClockP instance for updating the calendar.
The UART_Rx Pin is configured to receive interrupt. Device goes into low
power mode after the initial configurations.

When the UART is used, an interrupt will be triggered through the UART_Rx pin. This interrupt will enable the configuration of the UART in callback mode and set a timeout.


-   Valid UART packet is sent to the device to configure the base
    timestamp within the set timeout. **The red led toggles after a successful command execution or UART timeout. Make sure to enter the command before the led toggles**

-   Base Timestamp Configured: RTC is reset, Advertisement is started **(There may be a delay of around 30-60 seconds)** and GPIO Interrupt is enabled

-   GPIO Interrupt Event is Generated by pushing **BTN-1** on LP.
    Advertisement data and GATT Profile are updated to record current
    timestamp on GPIO Interrupt

-   BLE Central device is connected and paired using Passkey to read the encrypted data from
    the GATT Profile

To interact with the application over Bluetooth, you may use any device
that can act as a BLE Central device, such as

-   iOS with the apps SimpleLink Connect or other BLE application

-   Android with the apps SimpleLink Connect or other BLE application

-   A CC26xx/CC13xx/CC23xx LaunchPad running the sample app HostTest
    from a compatible SDK with the PC tool BTool from the same SDK.

### UART

This application uses the UART peripheral to provide a user interface.
The UART is used to issue commands to the device with
the format of packet as follows\
UART Packet

-   SOP(1) + CMD(1) + LENGTH OF PAYLOAD(2) + PAYLOAD(\"LOP\") + EOP(1)

-   S1192024-11-11-11-11-11E, UART Packet to configure base time stamp
    (CMD=1)

-   HEADER_SIZE : 4, SOP + CMD + LOP

-   FOOTER_SIZE : 1, EOP

We recommend using a serial terminal program that can parse ANSI/VT100 color
codes, such as Tera Term, PuTTY, Code Composer Studio Terminal, etc., to
monitor the LaunchPad UART output.

The following default parameters are used for the UART peripheral:

  UART Param     Default Values
  -------------- ----------------
  Baud Rate      115200
  Data length    8 bits
  Parity         None
  Stop bits      1 bit
  Flow Control   None

## Running the Demo

Running the demo is as simple as compiling and loading the code, then hooking
up to your PC to configuring base time over UART. Please see the steps below:

1. Compile and load the code
 - Build and load LaunchPad with the `ble_event_logger_LP_EM_CC2340R5_freertos_ticlang` project


2. Connect the board to the PC terminal
 - You can use the terminal to send data from your PC to the LaunchPad, and
 also display the info sent from one device to another.
 - Follow the steps from our [FAQ](../../../../../docs/faq.md) to connect to the LaunchPad boards
 - **Please note that the project uses the default baud rate of 115200**. 

3. In the terminal input some data to start UART, Then input the UART command to configure Base Timestamp. The red led toggles after the UART is timed out or the command is successfully executed.

4. GPIO events are performed by pushing LP BTN-1. You can change the GPIO used in SysConfig  

5. Using a sniffer utiltiy (Mobile Apps such as LightBlue-BLE,nRF Connect), verify that the Advertisement data contains Timestamp of the latest event. **The advertisement may take around 30-60 seconds to start after configuring the Base Time**.

6. Connect to `BLE EDL` device using SimpleLink Connect App

7. Open TI Terminal service. 5 Characteristics all with Auth Read will show up. 

9. Pair with the device using the default passkey '123456' to read the latest 5 Events.Make sure to modify the Format to Decimal on the Simple Link Connect app




